<nav class="navbar">
    <div class="nav-container">
        <a href="index.html" class="logo">Purely</a>
        <ul class="nav-links">
            <li><a href="index.html">Home</a></li>
            <li><a href="products.html">Products</a></li>
            <li><a href="about.html">About</a></li>
            <li><a href="contact.html">Contact</a></li>
        </ul>
        <div class="nav-icons">
            <span>üîç</span>
            <span id="cart-icon" style="display: flex; align-items: center; cursor: pointer;" onclick="window.location.href='cart.html'">
                üõí
                <span id="cart-count" class="cart-badge">0</span>
            </span>
            <button class="login-btn" id="login-btn" onclick="window.handleLoginClick ? window.handleLoginClick() : window.location.href='auth.html'">Login</button>
            <button class="login-btn" id="user-profile-btn" style="display: none; background: #4b0082; color: white;" onclick="window.handleProfileClick ? window.handleProfileClick() : null"></button>
        </div>
    </div>
</nav>

<script>
    // Define functions in window scope immediately
    window.handleLoginClick = function() {
        const user = JSON.parse(localStorage.getItem('purely_current_user'));
        const isAdmin = localStorage.getItem('purely_is_admin') === 'true';
        
        if (user) {
            const destination = isAdmin ? 'admin-dashboard.html' : 'customer-dashboard.html';
            window.location.href = destination;
        } else {
            window.location.href = 'auth.html';
        }
    };

    window.handleProfileClick = function() {
        const isAdmin = localStorage.getItem('purely_is_admin') === 'true';
        const confirmed = confirm('Click OK to go to dashboard or Cancel to logout');
        if (confirmed) {
            const destination = isAdmin ? 'admin-dashboard.html' : 'customer-dashboard.html';
            window.location.href = destination;
        } else {
            window.handleLogout();
        }
    };

    window.handleLogout = function() {
        localStorage.removeItem('purely_current_user');
        localStorage.removeItem('supabase_session');
        localStorage.removeItem('purely_is_admin');
        window.updateNavbarAuth();
        window.location.href = 'index.html';
    };

    window.updateNavbarAuth = function() {
        const user = JSON.parse(localStorage.getItem('purely_current_user'));
        const isAdmin = localStorage.getItem('purely_is_admin') === 'true';
        const loginBtn = document.getElementById('login-btn');
        const userBtn = document.getElementById('user-profile-btn');
        
        console.log('Updating navbar auth - user:', user ? user.name : 'none', 'admin:', isAdmin);
        
        if (loginBtn && userBtn) {
            if (user && user.name) {
                loginBtn.style.display = 'none';
                userBtn.style.display = 'block';
                const roleLabel = isAdmin ? ' (Admin)' : '';
                userBtn.textContent = 'üë§ ' + user.name + roleLabel;
                console.log('‚úì User logged in as:', user.name);
            } else {
                loginBtn.style.display = 'block';
                userBtn.style.display = 'none';
                console.log('‚úì User not logged in');
            }
        } else {
            console.warn('Navbar elements not found yet');
        }
    };
    
    // Call update immediately
    window.updateNavbarAuth();
    
    // Listen for storage changes (login from other tabs)
    window.addEventListener('storage', window.updateNavbarAuth);
    
    // Also add observer for when localStorage changes in same window
    const originalSetItem = localStorage.setItem;
    localStorage.setItem = function(key, value) {
        if (key === 'purely_current_user' || key === 'purely_is_admin') {
            console.log('localStorage changed:', key);
            window.updateNavbarAuth();
        }
        return originalSetItem.call(localStorage, key, value);
    };
</script>